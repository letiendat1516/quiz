<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Gh√©p Ch·ªØ - Coldbrew Prize</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #e50914 0%, #221f1f 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
            text-align: center;
            position: relative;
            border: 3px solid #e50914;
        }

        .title {
            color: #e50914;
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .tab-buttons {
            display: flex;
            margin-bottom: 30px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: linear-gradient(45deg, #e50914, #b20710);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .letters-display {
            font-size: 2.5em;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(45deg, #f8f9ff, #e8f4f8);
            border-radius: 15px;
            border: 3px solid #e50914;
            letter-spacing: 15px;
            font-weight: bold;
            color: #e50914;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .game-rules {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
            margin: 20px 0;
            text-align: left;
        }

        .progress-bar {
            background: #f0f0f0;
            border-radius: 10px;
            height: 25px;
            margin: 20px 0;
            overflow: hidden;
            border: 2px solid #e50914;
        }

        .progress-fill {
            background: linear-gradient(45deg, #28a745, #20c997);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .words-found {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .word-slot {
            padding: 12px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            background: #f8f9fa;
            font-weight: bold;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .word-slot.found {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: 2px solid #28a745;
            transform: scale(1.05);
        }

        .word-slot.master {
            border: 3px solid #ffc107;
            background: linear-gradient(45deg, #ffc107, #fd7e14);
        }

        .input-group {
            margin-bottom: 20px;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            font-size: 1.3em;
            border: 3px solid #e50914;
            border-radius: 10px;
            outline: none;
            transition: all 0.3s;
            text-align: center;
            text-transform: uppercase;
            font-weight: bold;
        }

        input:focus {
            border-color: #b20710;
            box-shadow: 0 0 10px rgba(229, 9, 20, 0.3);
        }

        .btn {
            background: linear-gradient(45deg, #e50914, #b20710);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(229, 9, 20, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #e83e8c);
        }

        .loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            z-index: 1000;
            border: 3px solid #e50914;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e50914;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #e50914;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #e50914;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            z-index: 1001;
        }

        .connected {
            background: #28a745;
            color: white;
        }

        .disconnected {
            background: #dc3545;
            color: white;
        }

        .hints-section {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #17a2b8;
        }

        .hint-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            text-align: left;
        }

        .prize-display {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 3px solid #e50914;
            color: #333;
        }

        .winner-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #28a745;
            text-align: left;
        }

        .contact-info {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 2px solid #17a2b8;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .letters-display {
                font-size: 2em;
                letter-spacing: 10px;
            }
            
            .title {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div>ƒêang t·∫£i game...</div>
        </div>

        <h1 class="title">üéÆ Game Gh√©p Ch·ªØ NetflixColdbrew</h1>
        
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab('game')">üéØ Ch∆°i Game</button>
            <button class="tab-btn" onclick="switchTab('prize')">üéÅ Gi·∫£i Th∆∞·ªüng</button>
        </div>

        <!-- Tab Ch∆°i Game -->
        <div id="game" class="tab-content active">
            <div id="gameContent">
                <!-- Letters Display -->
                <div class="letters-display" id="lettersDisplay">P - L - E - A - Q - U</div>
                
                <!-- Game Rules -->
                <div class="game-rules">
                    <h3>üìã Lu·∫≠t Ch∆°i:</h3>
                    <ul>
                        <li>‚úÖ T√¨m <strong>T·∫§T C·∫¢ 8 t·ª´</strong> t·ª´ 6 ch·ªØ c√°i: P, L, E, A, Q, U</li>
                        <li>‚úÖ M·ªói ch·ªØ c√°i ch·ªâ d√πng 1 l·∫ßn trong 1 t·ª´</li>
                        <li>‚úÖ T·ª´ t·ªëi thi·ªÉu 3 ch·ªØ c√°i</li>
                        <li>‚ö†Ô∏è <strong>B·∫ÆT BU·ªòC</strong> ph·∫£i t√¨m ƒë·ªß 8/8 t·ª´ ƒë·ªÉ nh·∫≠n Netflix</li>
                        <li>‚ùå Thi·∫øu 1 t·ª´ = Kh√¥ng c√≥ gi·∫£i th∆∞·ªüng</li>
                    </ul>
                </div>

                <!-- Progress Bar -->
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0/8 t·ª´</div>
                </div>

                <!-- Words Found Grid -->
                <div class="words-found" id="wordsGrid">
                    <div class="word-slot" data-word="APE" data-length="3">3 ch·ªØ c√°i</div>
                    <div class="word-slot" data-word="LEAP" data-length="4">4 ch·ªØ c√°i</div>
                    <div class="word-slot" data-word="PLEA" data-length="4">4 ch·ªØ c√°i</div>
                    <div class="word-slot master" data-word="PLAQUE" data-length="6">6 ch·ªØ c√°i üéØ</div>
                    <div class="word-slot" data-word="PAL" data-length="3">3 ch·ªØ c√°i</div>
                    <div class="word-slot" data-word="PEA" data-length="3">3 ch·ªØ c√°i</div>
                    <div class="word-slot" data-word="PALE" data-length="4">4 ch·ªØ c√°i</div>
                    <div class="word-slot master" data-word="EQUAL" data-length="5">5 ch·ªØ c√°i üéØ</div>
                </div>

                <!-- Input Section -->
                <div class="input-group">
                    <input type="text" id="playerZalo" placeholder="Nh·∫≠p s·ªë Zalo c·ªßa b·∫°n..." style="margin-bottom: 10px;" maxlength="15" />
                    <input type="text" id="wordInput" placeholder="Nh·∫≠p t·ª´ b·∫°n t√¨m ƒë∆∞·ª£c..." maxlength="6" />
                </div>

                <!-- Buttons -->
                <button class="btn" onclick="submitWord()">üöÄ G·ª≠i T·ª´</button>
                <button class="btn btn-danger" onclick="resetGame()">üîÑ L√†m L·∫°i</button>

                <!-- Hints Section -->
                <div class="hints-section" id="hintsSection" style="display: none;">
                    <h3>üí° G·ª£i √ù:</h3>
                    <div id="hintsList"></div>
                </div>
            </div>
        </div>

        <!-- Tab Gi·∫£i Th∆∞·ªüng -->
        <div id="prize" class="tab-content">
            <h2>üèÜ Gi·∫£i Th∆∞·ªüng Netflix Premium</h2>
            
            <div class="prize-display">
                <h3>üéÅ Gi·∫£i Th∆∞·ªüng Duy Nh·∫•t (8/8 t·ª´):</h3>
                <p><strong>üí∞ Gi√° tr·ªã: 50k</strong></p>
                <p><strong>‚è∞ H·∫°n s·ª≠ d·ª•ng: 30 ngaÃÄy</strong></p>
            </div>

            <!-- Winner Info (Hidden until someone wins) -->
            <div class="winner-info" id="winnerInfo" style="display: none;">
                <h4>üèÜ Ng∆∞·ªùi Chi·∫øn Th·∫Øng:</h4>
                <div class="contact-info">
                    <p><strong>üì± Zalo:</strong> <span id="winnerZalo">***</span></p>
                    <p><strong>‚è∞ Ho√†n th√†nh l√∫c:</strong> <span id="winnerTime">***</span></p>
                    <p><strong>üéØ T·ª´ t√¨m ƒë∆∞·ª£c:</strong> <span id="winnerWords">***</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Bi·∫øn to√†n c·ª•c
        let gameData = null;
        let foundWords = [];
        let hintsUsed = 0;

        // C·∫•u h√¨nh JSONBin
        const JSONBIN_CONFIG = {
            binId: '6869792a8561e97a50321995', // Thay b·∫±ng BinID c·ªßa b·∫°n
            apiKey: '$2a$10$ihUU69FzPM.tuVSf6jiUEOxlJM/9yDmbiMwmclO0cc8QDMm4wbfZm' // Thay b·∫±ng API Key c·ªßa b·∫°n
        };

        // Danh s√°ch t·ª´ ƒë√∫ng
        const TARGET_WORDS = [
            { word: "APE", length: 3, points: 50, difficulty: "easy" },
            { word: "LEAP", length: 4, points: 75, difficulty: "easy" },
            { word: "PLEA", length: 4, points: 75, difficulty: "easy" },
            { word: "PLAQUE", length: 6, points: 200, difficulty: "expert", isMaster: true },
            { word: "PAL", length: 3, points: 50, difficulty: "easy" },
            { word: "PEA", length: 3, points: 50, difficulty: "easy" },
            { word: "PALE", length: 4, points: 100, difficulty: "medium" },
            { word: "EQUAL", length: 5, points: 150, difficulty: "hard", isMaster: true }
        ];

        // G·ª£i √Ω
        const HINTS = [
            "üí° G·ª£i √Ω 1: C√≥ 3 t·ª´ 3 ch·ªØ c√°i (APE, PAL, PEA)",
            "üí° G·ª£i √Ω 2: C√≥ 3 t·ª´ 4 ch·ªØ c√°i (LEAP, PLEA, PALE)",
            "üí° G·ª£i √Ω 3: C√≥ 1 t·ª´ 5 ch·ªØ c√°i nghƒ©a l√† 'b·∫±ng nhau'",
            "üí° G·ª£i √Ω 4: T·ª´ 6 ch·ªØ c√°i li√™n quan ƒë·∫øn v·ªá sinh rƒÉng mi·ªáng"
        ];

        // Kh·ªüi t·∫°o khi trang load
        window.addEventListener('load', function() {
            loadGame();
            
            // Event listeners
            document.getElementById('wordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitWord();
                }
            });
            
            document.getElementById('playerZalo').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('wordInput').focus();
                }
            });

            // T·ª± ƒë·ªông uppercase input v√† validate Zalo
            document.getElementById('wordInput').addEventListener('input', function(e) {
                e.target.value = e.target.value.toUpperCase();
            });

            // Validate s·ªë Zalo (ch·ªâ cho ph√©p s·ªë)
            document.getElementById('playerZalo').addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
            });
        });

        // Chuy·ªÉn ƒë·ªïi tab
        function switchTab(tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'prize') {
                displayWinnerInfo();
            }
        }

        // T·∫£i d·ªØ li·ªáu game
        async function loadGame() {
            showLoading(true);
            
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_CONFIG.binId}/latest`, {
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.apiKey
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu');
                }
                
                const data = await response.json();
                gameData = data.record;
                
                displayGame();
                
            } catch (error) {
                console.error('L·ªói t·∫£i game:', error);
                showAlert('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server! S·ª≠ d·ª•ng d·ªØ li·ªáu offline.', 'error');
                createOfflineData();
            }
            
            showLoading(false);
        }

        // T·∫°o d·ªØ li·ªáu offline
        function createOfflineData() {
            gameData = {
                gameInfo: {
                    title: "Game Gh√©p Ch·ªØ P-L-E-A-Q-U (Offline Mode)",
                    description: "T√¨m T·∫§T C·∫¢ 8 t·ª´ ƒë·ªÉ nh·∫≠n Netflix Premium"
                },
                puzzle: {
                    givenLetters: ["P", "L", "E", "A", "Q", "U"],
                    targetWords: TARGET_WORDS,
                    foundWords: [],
                    currentScore: 0,
                    maxScore: 750
                },
                gameStatus: {
                    isActive: true,
                    isCompleted: false,
                    perfectScoreRequired: true
                },
                winner: {
                    hasWinner: false,
                    playerZalo: null,
                    completedAt: null,
                    wordsFound: [],
                    totalScore: 0,
                    hintsUsed: 0,
                    isPerfectScore: false,
                    qualifiedForPrize: false
                },
                prize: {
                    onlyPrize: {
                        title: "üèÜ Netflix Premium 1 NƒÉm",
                        netflixAccount: {
                            email: "wordchampion2025@gmail.com",
                            password: "PLEAQU8Perfect#2025"
                        },
                        netflixCookie: {
                            cookieString: "NetflixId=v%3D2%26ct%3DBQAOAAEBEF; SecureNetflixId=v%3D2%26mac%3DAQEAEAABABQOmBuLTdCv"
                        }
                    }
                },
                statistics: {
                    totalAttempts: 0,
                    perfectCompletions: 0,
                    successRate: 0,
                    averageWordsFound: 0
                }
            };
            
            displayGame();
        }

        // Hi·ªÉn th·ªã game
        function displayGame() {
            if (!gameData) return;
            
            // Ki·ªÉm tra game ƒë√£ c√≥ winner
            if (gameData.winner.hasWinner) {
                showGameCompletedMessage();
                return;
            }
            
            // Reset game state
            foundWords = [];
            hintsUsed = 0;
            
            updateProgress();
            updateWordsGrid();
            
            // Reset inputs
            document.getElementById('wordInput').value = '';
            document.getElementById('playerZalo').value = '';
            
            // ·∫®n hints
            document.getElementById('hintsSection').style.display = 'none';
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o game ƒë√£ k·∫øt th√∫c
        function showGameCompletedMessage() {
            const gameContent = document.getElementById('gameContent');
            // X·ª≠ l√Ω ·∫©n s·ªë Zalo
            let zalo = gameData.winner.playerZalo || '***';
            if (zalo.length >= 10) {
                zalo = '******' + zalo.slice(-4);
            }
            gameContent.innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <h2 style="color: #e50914; font-size: 2.5em; margin-bottom: 20px;">
                        üéÆ Game ƒê√£ K·∫øt Th√∫c
                    </h2>
                    
                    <div style="background: #f8d7da; padding: 25px; border-radius: 15px; margin: 20px 0; border: 3px solid #dc3545;">
                        <h3 style="color: #721c24;">‚è∞ ƒê√£ c√≥ ng∆∞·ªùi chi·∫øn th·∫Øng!</h3>
                        <p style="font-size: 1.2em; margin: 15px 0;">
                            Game ƒë√£ ƒë∆∞·ª£c ho√†n th√†nh b·ªüi ng∆∞·ªùi ch∆°i ƒë·∫ßu ti√™n.<br>
                            Netflix Premium ƒë√£ ƒë∆∞·ª£c trao cho ng∆∞·ªùi th·∫Øng cu·ªôc.
                        </p>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p><strong>üèÜ Ng∆∞·ªùi th·∫Øng:</strong> Zalo ${zalo}</p>
                            <p><strong>‚è∞ Ho√†n th√†nh l√∫c:</strong> ${gameData.winner.completedAt ? new Date(gameData.winner.completedAt).toLocaleString('vi-VN') : '***'}</p>
                            <p><strong>üéØ T·ª´ t√¨m ƒë∆∞·ª£c:</strong> ${gameData.winner.wordsFound ? gameData.winner.wordsFound.join(', ') : 'T·∫•t c·∫£ 8 t·ª´'}</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <p style="font-size: 1.1em; color: #666;">
                            C·∫£m ∆°n b·∫°n ƒë√£ tham gia!<br>
                            H√£y theo d√µi ƒë·ªÉ bi·∫øt th√™m c√°c th·ª≠ th√°ch m·ªõi.
                        </p>
                    </div>
                </div>
            `;
        }

        // G·ª≠i t·ª´
        function submitWord() {
            const wordInput = document.getElementById('wordInput');
            const playerZaloInput = document.getElementById('playerZalo');
            
            const word = wordInput.value.trim().toUpperCase();
            const playerZalo = playerZaloInput.value.trim();
            
            // Validation
            if (!word) {
                showAlert('Vui l√≤ng nh·∫≠p t·ª´!', 'error');
                return;
            }
            
            if (!playerZalo) {
                showAlert('Vui l√≤ng nh·∫≠p s·ªë Zalo c·ªßa b·∫°n!', 'error');
                playerZaloInput.focus();
                return;
            }

            // Validate s·ªë Zalo (10-11 s·ªë)
            if (playerZalo.length < 10 || playerZalo.length > 11) {
                showAlert('S·ªë Zalo kh√¥ng h·ª£p l·ªá! (10-11 s·ªë)', 'error');
                playerZaloInput.focus();
                return;
            }
            
            // Ki·ªÉm tra t·ª´ ƒë√£ t√¨m
            if (foundWords.includes(word)) {
                showAlert('B·∫°n ƒë√£ t√¨m t·ª´ n√†y r·ªìi!', 'warning');
                wordInput.value = '';
                return;
            }
            
            // Ki·ªÉm tra t·ª´ c√≥ ƒë√∫ng kh√¥ng
            const targetWord = TARGET_WORDS.find(t => t.word === word);
            if (targetWord) {
                // T·ª´ ƒë√∫ng!
                foundWords.push(word);
                showAlert(`üéâ Ch√≠nh x√°c! "${word}" (+${targetWord.points} ƒëi·ªÉm)`, 'success');
                
                updateProgress();
                updateWordsGrid();
                
                // Ki·ªÉm tra th·∫Øng
                if (foundWords.length === 8) {
                    endGame(true, playerZalo);
                }
                
                // Milestone messages
                const milestones = {
                    2: "üî• Kh·ªüi ƒë·∫ßu t·ªët! C√≤n 6 t·ª´ n·ªØa!",
                    4: "üí™ ƒê√£ qua n·ª≠a ch·∫∑ng! C√≤n 4 t·ª´!",
                    6: "‚ö° G·∫ßn ƒë·∫øn ƒë√≠ch r·ªìi! C√≤n 2 t·ª´ kh√≥!",
                    7: "üéØ Ch·ªâ c√≤n 1 t·ª´ cu·ªëi c√πng! C·ªë l√™n!"
                };
                
                if (milestones[foundWords.length]) {
                    setTimeout(() => {
                        showAlert(milestones[foundWords.length], 'success');
                    }, 1000);
                }
                
            } else {
                // T·ª´ sai
                showAlert(`‚ùå "${word}" kh√¥ng ph·∫£i l√† t·ª´ c·∫ßn t√¨m!`, 'error');
            }
            
            wordInput.value = '';
            wordInput.focus();
        }

        // C·∫≠p nh·∫≠t progress bar
        function updateProgress() {
            const progress = (foundWords.length / 8) * 100;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = progress + '%';
            progressFill.textContent = `${foundWords.length}/8 t·ª´`;
            
            if (foundWords.length >= 4) {
                progressFill.style.background = 'linear-gradient(45deg, #ffc107, #fd7e14)';
            }
            if (foundWords.length >= 6) {
                progressFill.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
            }
        }

        // C·∫≠p nh·∫≠t l∆∞·ªõi t·ª´
        function updateWordsGrid() {
            const slots = document.querySelectorAll('.word-slot');
            slots.forEach(slot => {
                const word = slot.getAttribute('data-word');
                if (foundWords.includes(word)) {
                    slot.classList.add('found');
                    slot.textContent = word;
                    
                    // Th√™m ƒë·ªãnh nghƒ©a
                    const definitions = {
                        "APE": "APE üêµ",
                        "LEAP": "LEAP ü¶ò", 
                        "PLEA": "PLEA üôè",
                        "PLAQUE": "PLAQUE ü¶∑",
                        "PAL": "PAL üë•",
                        "PEA": "PEA üü¢",
                        "PALE": "PALE üò∞",
                        "EQUAL": "EQUAL ‚öñÔ∏è"
                    };
                    slot.textContent = definitions[word] || word;
                }
            });
        }

        // Hi·ªÉn th·ªã g·ª£i √Ω
        function showHint() {
            showAlert('Ch·ª©c nƒÉng g·ª£i √Ω ƒë√£ b·ªã t·∫Øt!', 'warning');
        }

        // K·∫øt th√∫c game
        async function endGame(isWinner, playerZalo) {
            if (isWinner) {
                // Ng∆∞·ªùi ch∆°i th·∫Øng!
                showAlert('üéâ CH√öC M·ª™NG! B·∫°n ƒë√£ ho√†n th√†nh th·ª≠ th√°ch!', 'success');
                
                // C·∫≠p nh·∫≠t d·ªØ li·ªáu winner
                gameData.winner = {
                    hasWinner: true,
                    playerZalo: playerZalo,
                    completedAt: new Date().toISOString(),
                    wordsFound: [...foundWords],
                    totalScore: calculateScore(),
                    hintsUsed: hintsUsed,
                    isPerfectScore: true,
                    qualifiedForPrize: true
                };
                
                gameData.gameStatus.isCompleted = true;
                gameData.statistics.totalAttempts++;
                gameData.statistics.perfectCompletions++;
                
                // L∆∞u d·ªØ li·ªáu
                try {
                    showLoading(true);
                    await saveToJsonBin();
                    showLoading(false);
                    
                    showWinnerScreen(playerZalo);
                    
                } catch (error) {
                    console.error('L·ªói l∆∞u d·ªØ li·ªáu:', error);
                    showAlert('L·ªói l∆∞u d·ªØ li·ªáu! Vui l√≤ng ch·ª•p m√†n h√¨nh l√†m b·∫±ng ch·ª©ng.', 'error');
                    showWinnerScreen(playerZalo);
                }
            }
        }

        // T√≠nh ƒëi·ªÉm
        function calculateScore() {
            let score = 0;
            foundWords.forEach(word => {
                const targetWord = TARGET_WORDS.find(t => t.word === word);
                if (targetWord) {
                    score += targetWord.points;
                }
            });
            
            // Bonus cho ho√†n th√†nh
            if (foundWords.length === 8) {
                score += 500; // Perfect completion bonus
            }
            
            // Penalty cho hints
            score -= hintsUsed * 25;
            
            return score;
        }

        // Hi·ªÉn th·ªã m√†n h√¨nh chi·∫øn th·∫Øng
        function showWinnerScreen(playerZalo) {
            const gameContent = document.getElementById('gameContent');
            
            gameContent.innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <h2 style="color: #28a745; font-size: 2.5em; margin-bottom: 20px;">
                        üèÜ CH√öC M·ª™NG B·∫†N ƒê√É TH·∫ÆNG! üèÜ
                    </h2>
                    
                    <div style="background: linear-gradient(45deg, #ffd700, #ffed4e); padding: 25px; border-radius: 15px; margin: 20px 0; border: 3px solid #28a745;">
                        <h3>üëë Ng∆∞·ªùi ch∆°i ƒë·∫ßu ti√™n ho√†n th√†nh!</h3>
                        <p><strong>üì± Zalo:</strong> ${playerZalo}</p>
                        <p><strong>üéØ T·ª´ t√¨m ƒë∆∞·ª£c:</strong> ${foundWords.join(', ')}</p>
                        <p><strong>üíØ ƒêi·ªÉm s·ªë:</strong> ${calculateScore()}</p>
                        <p><strong>üí° G·ª£i √Ω s·ª≠ d·ª•ng:</strong> ${hintsUsed}/4</p>
                        <p><strong>‚è∞ Ho√†n th√†nh l√∫c:</strong> ${new Date().toLocaleString('vi-VN')}</p>
                    </div>
                    
                    <div style="background: #d4edda; padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid #28a745;">
                        <h3 style="color: #155724;">üéÅ Netflix Premium Account</h3>
                        <p style="color: #155724; font-size: 1.2em; font-weight: bold;">
                            
                            üì± Vui l√≤ng li√™n h√™Ã£ v∆°ÃÅi admin ƒë√™Ãâ nh√¢Ã£n taÃÄi khoaÃân
                        </p>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border: 2px solid #28a745;">
                            <h4 style="color: #155724;">üì¶ B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c:</h4>
                            <ul style="text-align: left; color: #155724;">
                                <li>üìß TaÃÄi khoaÃân Netflix Premium</li>
                                <li>‚è∞ H·∫°n s·ª≠ d·ª•ng: 30 ngaÃÄy</li>
                                <li>üí∞ Tr·ªã gi√°: 50k</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn" onclick="loadGame()">üîÑ T·∫£i L·∫°i Trang</button>
                    </div>
                </div>
            `;
        }

        // Li√™n h·ªá h·ªó tr·ª£
        function contactSupport(playerZalo) {
            const message = `
üèÜ WINNER SUPPORT REQUEST

üì± Zalo: ${playerZalo}
‚è∞ Won at: ${new Date().toLocaleString('vi-VN')}
üéØ Words: ${foundWords.join(', ')}
üíØ Score: ${calculateScore()}
üí° Hints used: ${hintsUsed}/4

Please send Netflix Premium account details.
            `.trim();
            
            // Copy to clipboard
            navigator.clipboard.writeText(message).then(() => {
                showAlert('üìã Th√¥ng tin ƒë√£ ƒë∆∞·ª£c copy! G·ª≠i cho admin ƒë·ªÉ nh·∫≠n Netflix.', 'success');
            }).catch(() => {
                alert('Th√¥ng tin winner:\n\n' + message);
            });
        }

        // Reset game
        function resetGame() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën l√†m l·∫°i? Ti·∫øn tr√¨nh hi·ªán t·∫°i s·∫Ω b·ªã m·∫•t!')) {
                foundWords = [];
                hintsUsed = 0;
                
                updateProgress();
                updateWordsGrid();
                
                // Reset inputs
                document.getElementById('wordInput').value = '';
                document.getElementById('wordInput').disabled = false;
                document.querySelector('button[onclick="submitWord()"]').disabled = false;
                
                // ·∫®n hints
                document.getElementById('hintsSection').style.display = 'none';
                document.getElementById('hintsList').innerHTML = '';
                document.getElementById('hintButton').textContent = 'üí° G·ª£i √ù (4 l·∫ßn)';
                document.getElementById('hintButton').style.display = 'inline-block';
                
                showAlert('üîÑ Game ƒë√£ ƒë∆∞·ª£c reset!', 'success');
            }
        }

        // L∆∞u d·ªØ li·ªáu l√™n JSONBin
        async function saveToJsonBin() {
            const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_CONFIG.binId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Master-Key': JSONBIN_CONFIG.apiKey
                },
                body: JSON.stringify(gameData)
            });
            
            if (!response.ok) {
                throw new Error('Kh√¥ng th·ªÉ l∆∞u d·ªØ li·ªáu');
            }
        }

        // T·∫£i th·ªëng k√™
        function loadStats() {
            if (!gameData) return;
            
            document.getElementById('totalAttempts').textContent = gameData.statistics.totalAttempts || 0;
            document.getElementById('perfectCompletions').textContent = gameData.statistics.perfectCompletions || 0;
            
            const successRate = gameData.statistics.totalAttempts > 0 
                ? Math.round((gameData.statistics.perfectCompletions / gameData.statistics.totalAttempts) * 100)
                : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            document.getElementById('averageWords').textContent = gameData.statistics.averageWordsFound || 0;
        }

        // Hi·ªÉn th·ªã th√¥ng tin winner
        function displayWinnerInfo() {
            if (gameData && gameData.winner.hasWinner) {
                document.getElementById('winnerInfo').style.display = 'block';
                // Hi·ªÉn th·ªã 6 s·ªë ƒë·∫ßu l√† * v√† ch·ªâ 4 s·ªë cu·ªëi
                let zalo = gameData.winner.playerZalo || '***';
                if (zalo.length >= 10) {
                    zalo = '******' + zalo.slice(-4);
                }
                document.getElementById('winnerZalo').textContent = zalo;
                document.getElementById('winnerTime').textContent = gameData.winner.completedAt 
                    ? new Date(gameData.winner.completedAt).toLocaleString('vi-VN') 
                    : '***';
                document.getElementById('winnerWords').textContent = gameData.winner.wordsFound 
                    ? gameData.winner.wordsFound.join(', ') 
                    : 'T·∫•t c·∫£ 8 t·ª´';
            } else {
                document.getElementById('winnerInfo').style.display = 'none';
            }
        }

        // Utility functions
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showAlert(message, type = 'success') {
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(alert, container.firstChild);
            
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        function updateConnectionStatus(connected) {
            // ƒê√£ lo·∫°i b·ªè ph·∫ßn tr·∫°ng th√°i k·∫øt n·ªëi
        }

        // X·ª≠ l√Ω khi m·∫•t k·∫øt n·ªëi
        window.addEventListener('online', function() {
            updateConnectionStatus(true);
            loadGame();
        });

        window.addEventListener('offline', function() {
            updateConnectionStatus(false);
        });

        // X·ª≠ l√Ω ph√≠m t·∫Øt
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                loadGame();
            }
        });

        // Mobile responsive
        function handleResize() {
            if (window.innerWidth <= 768) {
                document.querySelectorAll('.btn').forEach(btn => {
                    btn.style.width = '100%';
                    btn.style.marginBottom = '10px';
                });
            } else {
                document.querySelectorAll('.btn').forEach(btn => {
                    btn.style.width = 'auto';
                    btn.style.marginBottom = '0';
                });
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize();

        // Debug
        window.debugInfo = function() {
            console.log('Game Data:', gameData);
            console.log('Found Words:', foundWords);
            console.log('Hints Used:', hintsUsed);
        };

        console.log('üéÆ Game Gh√©p Ch·ªØ ƒë√£ kh·ªüi t·∫°o!');
        console.log('üìù G√µ debugInfo() ƒë·ªÉ xem th√¥ng tin debug');
    </script>
</body>
</html>
